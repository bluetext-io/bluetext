modules:
  - id: api
    module: polytope/python
    params:
      - id: dev-mode
        info: Whether to run in dev mode (with hot reload, debugging).
        type: [default, bool, true]
    args:
      id: api
      image: public.ecr.aws/docker/library/python:3.13-slim-bookworm
      code: { type: host, path: api }
      cmd: ./bin/run
      restart:
        policy: always
      services:
        - { id: api, ports: [{protocol: http, port: 3001, expose-as: 3001}] }
      env:
        - { name: HTTP_PORT, value: 3001 }
        - { name: LOG_LEVEL, value: INFO }
        - { name: HTTP_DEBUG, value: dev }
        - { name: HTTP_AUTORELOAD, value: dev }
        - { name: COUCHBASE_URL, value: couchbase://couchbase }
        - { name: COUCHBASE_USERNAME, value: user }
        - { name: COUCHBASE_PASSWORD, value: password }
        - { name: COUCHBASE_BUCKET, value: main }
      mounts:
        - { path: /root/.cache/, source: { type: volume, scope: project, id: dependency-cache } }
        - { path: /root/conf/, source: { type: host, path: ./conf } }
