modules:
  - id: {{ project-name }}
    info: "'Base' module for other modules in this file to build on."
    module: polytope/python
    args:
      id: {{ project-name }}
      image: astral/uv:python3.13-alpine
      code: { type: host, path: {{ path }} }
      cmd: ./bin/run
      restart:
        policy: always
      services:
        - { id: {{ project-name }}, ports: [{protocol: http, port: 3001, expose-as: 3001}] }
      env:
        - { name: HTTP_AUTORELOAD, value: true }
        - { name: HTTP_PORT, value: 3030 }
        - { name: LOG_LEVEL, value: INFO }

        # Change this section if this api is set up for couchbase and you want to change the credentials
        - { name: COUCHBASE_URL, value: couchbase://couchbase }
        - { name: COUCHBASE_USERNAME, value: user }
        - { name: COUCHBASE_PASSWORD, value: password }
        - { name: COUCHBASE_BUCKET, value: main }

        # Change this section if this api is set up for postgres and you want to change the port
        - { name: POSTGRES_HOST, value: postgres }
      mounts:
        - { path: /root/.cache/, source: { type: volume, scope: project, id: {{ project-name | kebab_case}}-dependency-cache } }
  - id: {{ project-name }}-add
    info: Adds one or more packages to the pyproject.toml file.
    module: {{ project-name }}
    params:
      - id: packages
        info: comma/whitespace-separated list of python packages to add to pyproject.toml
        type: str
    args:
      id: {{ project-name }}-add
      restart-policy: on-failure
      cmd: '#pt-js "uv add --no-progress " + params.packages.replace(/[\s,]+/g, " ")'
